function LEEFLETS(){var e=this,t=$(".primary-menu"),n=$(".viewer"),r=$(".clip"),i=$(".contain-all"),s=$(".panel-container");e.assets_url=function(e){var t=e.lastIndexOf("/");e=e.substr(0,t);t=e.lastIndexOf("/");return e.substr(0,t)}(JS_SELF_URL);e.wysihtml5_options={html:!0,image:!1,useLineBreaks:!1,stylesheets:[e.assets_url+"/css/editor.css"],parserRules:{tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},blockquote:{},p:{},u:1,span:1,div:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{set_attributes:{target:"_blank",rel:"nofollow"},check_attributes:{href:"url"}}}}};e.init=function(){e.nav_events();e.panel_events($(".panel.admin"));e.panel_events_once($(".panel.admin"));e.drag_events();e.shortcut_keys();e.size_containers();on_resize(e.size_containers)};e.size_contain_all=function(){var e=t.outerWidth()+s.outerWidth()+n.outerWidth();i.width(e)};e.size_containers=function(){n.width($("body").width());e.size_contain_all()};e.shortcut_keys=function(){$(document).keyup(function(t){t.keyCode==27&&e.hide_all()})};e.drag_events=function(){$(document).bind("drop dragover",function(e){e.preventDefault()})};e.install_events=function(){if(!$("body.logged-out").length)return};e.connection_field_events=function(){$("fieldset.connection").each(function(){var t=$(this);e.hide_show_connection_fields(t);$("select",t).change(function(){e.hide_show_connection_fields(t)})})};e.field_events=function(t){$("textarea.wysihtml5",t).each(function(){$(this).wysihtml5(e.wysihtml5_options)});var n;t.hasClass("panel")?n=t:n=t.parents(".panel.admin");$("input.datepicker",t).datepicker({attachTo:n});$("div.file-upload",t).each(function(){var t=$(this),n=$(".drop-pad",t),r=$("input[type=file]",t),i=$(".progress",t),s=null;r.fileupload({url:r.data("upload-url"),paramName:"files",formData:[{name:"input-name",value:r.data("name")}],dataType:"json",dropZone:n,done:function(s,o){i.hide();if(typeof o.result.error!="undefined"){var u=$(e.get_error_html(o.result.error));t.append(u);u.hide().fadeIn();return}$(".file-list",t).remove();i.after(o.result.list);e.file_list_events(t,n);e.sequence_fields(t.parents("fieldset.repeatable"));!r.attr("multiple")&&!$(".alert-error",t)[0]&&n.hide();e.reload_viewer()},dragover:function(e){clearTimeout(s);n.addClass("dragover");s=setTimeout(function(){n.removeClass("dragover")},100)},progressall:function(e,n){var r=parseInt(n.loaded/n.total*100,10);$(".progress .bar",t).css("width",r+"%")},start:function(e){$(".alert-error",t).remove();$(".progress",t).show();$(".progress .bar",t).css("width","1%")}});e.file_list_events(t,n)})};e.file_list_events=function(t,n){var r=$(".file-list",t);$(".file-preview",r).tooltip({container:"body",placement:"bottom"});$(".remove",r).click(function(){var r=$(this).parents(".file-item");$.ajax($(this).attr("href"),{type:"GET",dataType:"json",success:function(i,s,o){if(i.success){r.remove();n.show();e.reload_viewer();$(".alert-error",t).remove()}else{var u;typeof i.error=="undefined"?u="Failed to remove file.":u=i.error;$(".alert-error",t).remove();var a=$(e.get_error_html(u));t.append(a);a.hide().fadeIn()}}});return!1})};e.panel_events_once=function(e){$(".button-bar .submit",e).click(function(){$("form",e).submit()})};e.store_panel_events=function(t){if(!t.hasClass("store"))return;$(".activate-template",t).click(function(){$.get($(this).attr("href"),{ajax:1,slim:1},function(n){if(n){$(".span12",t).html(n);e.reload_viewer();e.panel_events(t)}else alert("Error activating this template.")});return!1});var n=!1;$(".toggle-button",t).toggleButtons({onChange:function(e,t,r){if(n){n=!1;return}var i=$("input",e),s=e.parents("form").attr("action");s+=i.val()+"/";t?s+="on/":s+="off/";$.get(s,function(t){if(t){alert(t);n=!0;e.toggleButtons("toggleState")}else document.location.reload(!0)})}});$("[data-ajax-fill]",t).each(function(){var e=$(this);$.get(e.data("ajax-fill"),{ajax:1},function(t){e.html(t)})})};e.panel_events=function(t){e.field_events(t);e.repeatable(t);e.store_panel_events(t);$(".close.panel",t).click(function(){e.toggle_panel(t)});e.connection_field_events();$("form",t).submit(function(){$("fieldset.repeatable",this).each(function(){$("fieldset:hidden",this).remove()});$(".button-bar .alert",t).hide();var n=$(this).serialize();n+="&ajax=1";$.post($(this).attr("action"),n,function(n){$(".span12",t).html(n);e.reload_viewer();e.panel_events(t);if($(".error:visible",t)[0]){var r=$(".button-bar .alert-error",t);r.fadeIn(function(){window.setTimeout(function(){r.fadeOut()},5e3)})}else{var i=$(".button-bar .alert-success",t);i.fadeIn(function(){window.setTimeout(function(){i.fadeOut()},5e3)})}});return!1})};e.reload_viewer=function(){n[0].src=n[0].src};e.get_error_html=function(e){return'			<div class="alert alert-error">				<button type="button" class="close" data-dismiss="alert">Ã—</button>				'+e+"			</div>		"};e.hide_show_connection_fields=function(e){"direct"==$("select",e).val()?$(".control-group",e).not(".type").hide():$(".control-group",e).not(".type").show()};e.repeatable=function(t){if(!t.length)return;var n=$("fieldset.repeatable",t);n.each(function(){var e=$(this),t=$('<p class="add-first"><a href="">Add new</a></p>');e.append(t);$("a",t).click(function(){$("fieldset",e).show();t.hide();return!1});$("fieldset",e).length>0&&t.hide()});$("fieldset",n).each(function(){$(this).prepend('				<div class="btn-toolbar">					<div class="btn-group">						<a class="btn remove-group" href="#"><i class="icon-minus"></i></a>						<a class="btn add-group" href="#"><i class="icon-plus"></i></a>						<a class="btn down-group" href="#"><i class="icon-arrow-down"></i></a>						<a class="btn up-group" href="#"><i class="icon-arrow-up"></i></a>					</div>				</div>			');e.field_group_events($(this))})};e.cleanup_wysiwyg=function(e){$("div.textarea.wysihtml5",e).each(function(){$("input[type=hidden], .wysihtml5-toolbar, .wysihtml5-sandbox",this).remove();$("textarea",this).show()})};e.clear_field_values=function(e){$("input, textarea, select",e).val("");var t=$("textarea.wysihtml5",e).data("wysihtml5");typeof t!="undefined"&&t.editor.clear();$(".file-list",e).remove();$(".drop-pad",e).show()};e.field_group_events=function(t){$(".add-group",t).click(function(){var n=t.clone();e.clear_field_values(n);t.after(n);e.cleanup_wysiwyg(n);e.field_group_events(n);e.field_events(n);e.sequence_fields(t.parents("fieldset.repeatable"));return!1});$(".remove-group",t).click(function(){var n=t.parents("fieldset.repeatable");if($("fieldset",n).length==1){e.clear_field_values(t);t.hide();$(".add-first",n).show()}else t.remove();e.sequence_fields(n);return!1});$(".down-group",t).click(function(){e.swap(t.next(),t,function(){var n=t.parents("fieldset.repeatable");e.sequence_fields(n)});return!1});$(".up-group",t).click(function(){e.swap(t,t.prev(),function(){var n=t.parents("fieldset.repeatable");e.sequence_fields(n)});return!1})};e.swap=function(t,n,r){var i=t.outerHeight()+n.outerHeight(),s=$("<div />");s.css({height:i+"px"});var o=t.position(),u=n.position(),a=500;t.animate({top:t.outerHeight()*-1+"px"},a);n.animate({top:n.outerHeight()+"px"},a,function(){n.before(t);t.css({top:"auto"});n.css({top:"auto"});e.cleanup_wysiwyg(t);$(".control-group.wysihtml5",t).each(function(){$(this).wysihtml5(e.wysihtml5_options)});r&&r()})};e.sequence_fields=function(e){$("fieldset",e).each(function(e){var t=$(this);$("input, textarea, select",t).not("input[type=file]").each(function(){if(!$(this).attr("name"))return;var t=$(this).attr("name").replace(/\[[0-9]+\]/,"["+e+"]");$(this).attr("name",t)});$("input[type=file]",t).each(function(){if(!$(this).data("name"))return;var t=$(this).data("name").replace(/\[[0-9]+\]/,"["+e+"]");$(this).data("name",t)})})};e.slide_visible=function(e){var t=e.css("margin-left");typeof t=="undefined"?t="0":t=t.replace("px","");return t=="0"};e.animate_slide=function(e,t,n,r){e.animate({"margin-left":t+"px"},n,r)};e.show_slide=function(t,n,r){e.animate_slide(t,0,n,r)};e.hide_slide=function(t,n,r){var i=-1*t.outerWidth();e.animate_slide(t,i,n,r)};e.toggle_slide=function(t,n){e.slide_visible(t)?e.hide_slide(t,n):e.show_slide(t,n)};e.show_nav=function(){e.show_slide(t,200)};e.hide_nav=function(){e.hide_slide(t,200)};e.toggle_nav=function(){e.slide_visible(t)?e.hide_nav():e.show_nav()};e.show_panel=function(t,n){t.show();var r=t.width();s.width(r);s.css("margin-left",-1*r+"px");e.size_contain_all();e.show_slide(s,400,n)};e.hide_panel=function(t,n){e.hide_slide(s,400,function(){t?t.hide():$(".panel.admin:visible").hide();n&&n()})};e.toggle_panel=function(n){var r=$(".panel.admin:visible");if(r.length)if(r[0]===n[0]){e.hide_panel(n);$(".active",t).removeClass("active")}else e.hide_panel(r,function(){e.show_panel(n)});else e.show_panel(n)};e.hide_all=function(){e.toggle_nav();e.hide_panel();$(".active",t).removeClass("active")};e.load_panel=function(t){var n=md5(t),r=$("#admin-"+n);if(r.length){e.toggle_panel(r);return!1}$.get(t,{ajax:1},function(t){var r=$(t);r.attr("id","admin-"+n);r.hide();s.append(r);e.panel_events(r);e.panel_events_once(r);e.toggle_panel(r)});return!1};e.load_content_panel=function(n){var r=t.data("content-url");r=r+n.replace(/\s+/,"/")+"/";e.load_panel(r);e.show_nav()};e.nav_events=function(){var n=$(".panel.admin");if(n.length){e.show_nav();e.show_panel(n)}$(".show-primary-nav").click(function(){e.show_nav();return!1});$("a",t).click(function(){$(".active",t).removeClass("active")});$(".home",t).click(function(){e.hide_all();return!1});$(".settings, .content, .store",t).click(function(){$(this).addClass("active");e.load_panel($(this).attr("href"));return!1});$(".publish",t).click(function(){$.get($(this).attr("href"),{ajax:1},function(e){var t=$(".alert-box.published");if(!t.length){t=$('<div class="alert-box published"></div>');$("body").append(t)}e?t.html("Published! :)"):t.html("Sorry, could not write to index.html :(");t.hide().fadeIn(function(){window.setTimeout(function(){t.fadeOut()},1e3)})});return!1})}}function on_resize(e,t){onresize=function(){clearTimeout(t);t=setTimeout(e,100)};return e}var JS_SELF_URL=function(){var e=document.getElementsByTagName("script");return e[e.length-1].src}(),leeflets;$(document).ready(function(){leeflets=new LEEFLETS;leeflets.init()});(function(e,t,n){"use strict";e.fn.backstretch=function(r,s){return(r===n||r.length===0)&&e.error("No images were supplied for Backstretch"),e(t).scrollTop()===0&&t.scrollTo(0,0),this.each(function(){var t=e(this),n=t.data("backstretch");n&&(s=e.extend(n.options,s),n.destroy(!0)),n=new i(this,r,s),t.data("backstretch",n)})},e.backstretch=function(t,n){return e("body").backstretch(t,n).data("backstretch")},e.expr[":"].backstretch=function(t){return e(t).data("backstretch")!==n},e.fn.backstretch.defaults={centeredX:!0,centeredY:!0,duration:5e3,fade:0};var r={wrap:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},img:{position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"auto",height:"auto",maxWidth:"none",zIndex:-999999}},i=function(n,i,o){this.options=e.extend({},e.fn.backstretch.defaults,o||{}),this.images=e.isArray(i)?i:[i],e.each(this.images,function(){e("<img />")[0].src=this}),this.isBody=n===document.body,this.$container=e(n),this.$wrap=e('<div class="backstretch"></div>').css(r.wrap).appendTo(this.$container),this.$root=this.isBody?s?e(t):e(document):this.$container;if(!this.isBody){var u=this.$container.css("position"),a=this.$container.css("zIndex");this.$container.css({position:u==="static"?"relative":u,zIndex:a==="auto"?0:a,background:"none"}),this.$wrap.css({zIndex:-999998})}this.$wrap.css({position:this.isBody&&s?"fixed":"absolute"}),this.index=0,this.show(this.index),e(t).on("resize.backstretch",e.proxy(this.resize,this)).on("orientationchange.backstretch",e.proxy(function(){this.isBody&&t.pageYOffset===0&&(t.scrollTo(0,1),this.resize())},this))};i.prototype={resize:function(){try{var e={left:0,top:0},n=this.isBody?this.$root.width():this.$root.innerWidth(),r=n,i=this.isBody?t.innerHeight?t.innerHeight:this.$root.height():this.$root.innerHeight(),s=r/this.$img.data("ratio"),o;s>=i?(o=(s-i)/2,this.options.centeredY&&(e.top="-"+o+"px")):(s=i,r=s*this.$img.data("ratio"),o=(r-n)/2,this.options.centeredX&&(e.left="-"+o+"px")),this.$wrap.css({width:n,height:i}).find("img:not(.deleteable)").css({width:r,height:s}).css(e)}catch(u){}return this},show:function(t){if(Math.abs(t)>this.images.length-1)return;this.index=t;var n=this,i=n.$wrap.find("img").addClass("deleteable"),s=e.Event("backstretch.show",{relatedTarget:n.$container[0]});return clearInterval(n.interval),n.$img=e("<img />").css(r.img).bind("load",function(t){var r=this.width||e(t.target).width(),o=this.height||e(t.target).height();e(this).data("ratio",r/o),e(this).fadeIn(n.options.speed||n.options.fade,function(){i.remove(),n.paused||n.cycle(),n.$container.trigger(s,n)}),n.resize()}).appendTo(n.$wrap),n.$img.attr("src",n.images[t]),n},next:function(){return this.show(this.index<this.images.length-1?this.index+1:0)},prev:function(){return this.show(this.index===0?this.images.length-1:this.index-1)},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.next(),this},cycle:function(){return this.images.length>1&&(clearInterval(this.interval),this.interval=setInterval(e.proxy(function(){this.paused||this.next()},this),this.options.duration)),this},destroy:function(n){e(t).off("resize.backstretch orientationchange.backstretch"),clearInterval(this.interval),n||this.$wrap.remove(),this.$container.removeData("backstretch")}};var s=function(){var e=navigator.userAgent,n=navigator.platform,r=e.match(/AppleWebKit\/([0-9]+)/),i=!!r&&r[1],s=e.match(/Fennec\/([0-9]+)/),o=!!s&&s[1],u=e.match(/Opera Mobi\/([0-9]+)/),a=!!u&&u[1],f=e.match(/MSIE ([0-9]+)/),l=!!f&&f[1];return!((n.indexOf("iPhone")>-1||n.indexOf("iPad")>-1||n.indexOf("iPod")>-1)&&i&&i<534||t.operamini&&{}.toString.call(t.operamini)==="[object OperaMini]"||u&&a<7458||e.indexOf("Android")>-1&&i&&i<533||o&&o<6||"palmGetResource"in t&&i&&i<534||e.indexOf("MeeGo")>-1&&e.indexOf("NokiaBrowser/8.5.0")>-1||l&&l<=6)}()})(jQuery,window);!function(e){var t=function(e,t,n){var r=0,i=t.length;for(;r<i;r++)e=e[t[r]]=e[t[r]]||r==i-1?n:{}};e.fn.toggleButtons=function(n){var r,i,s=.05,o={init:function(n){this.each(function(){var o,u,l,p,v={};r=e(this);r.addClass("toggle-button");e.each(r.data(),function(n,r){var i,s={};if(n.indexOf("togglebutton")===0){i=n.match(/[A-Z][a-z]+/g);i=e.map(i,function(e){return e.toLowerCase()});t(s,i,r);v=e.extend(!0,v,s)}});l=e.extend(!0,{},e.fn.toggleButtons.defaults,n,v);e(this).data("options",l);o=e("<span></span>").addClass("labelLeft").text(l.label.enabled===undefined?"ON":l.label.enabled);u=e("<span></span>").addClass("labelRight").text(l.label.disabled===undefined?"OFF":l.label.disabled);i=r.find("input:checkbox").wrap(e("<div></div>")).parent();i.append(o);i.append(e("<label></label>").attr("for",r.find("input").attr("id")));i.append(u);r.find("input").is(":checked")?r.find(">div").css("left","0"):r.find(">div").css("left","-50%");l.animated?l.transitionspeed!==undefined&&(/^(\d*%$)/.test(l.transitionspeed)?s=.05*parseInt(l.transitionspeed)/100:s=l.transitionspeed):s=0;e(this).data("transitionSpeed",s*1e3);l.width/=2;r.css("width",l.width*2).find(">div").css("width",l.width*3).find(">span, >label").css("width",l.width);r.css("height",l.height).find("span, label").css("height",l.height).filter("span").css("line-height",l.height+"px");r.find("input").is(":disabled")&&e(this).addClass("deactivate");r.find("span").css(l.font);if(l.style.enabled===undefined){if(l.style.custom!==undefined&&l.style.custom.enabled!==undefined&&l.style.custom.enabled.background!==undefined){o.css("color",l.style.custom.enabled.color);l.style.custom.enabled.gradient===undefined?o.css("background",l.style.custom.enabled.background):e.each(["-webkit-","-moz-","-o-",""],function(e,t){o.css("background-image",t+"linear-gradient(top, "+l.style.custom.enabled.background+","+l.style.custom.enabled.gradient+")")})}}else o.addClass(l.style.enabled);if(l.style.disabled===undefined){if(l.style.custom!==undefined&&l.style.custom.disabled!==undefined&&l.style.custom.disabled.background!==undefined){u.css("color",l.style.custom.disabled.color);l.style.custom.disabled.gradient===undefined?u.css("background",l.style.custom.disabled.background):e.each(["-webkit-","-moz-","-o-",""],function(e,t){u.css("background-image",t+"linear-gradient(top, "+l.style.custom.disabled.background+","+l.style.custom.disabled.gradient+")")})}}else u.addClass(l.style.disabled);var m=function(e){e.siblings("label").trigger("mousedown").trigger("mouseup").trigger("click")};o.on("click",function(t){m(e(this))});u.on("click",function(t){m(e(this))});r.find("input").on("change",function(t,n){var r=e(this).parent(),i=e(this).is(":checked"),s=e(this).closest(".toggle-button");r.stop().animate({left:i?"0":"-50%"},s.data("transitionSpeed"));l=s.data("options");n||l.onChange(r,i,t)});r.find("label").on("mousedown touchstart",function(t){p=!1;t.preventDefault();t.stopImmediatePropagation();if(e(this).closest(".toggle-button").is(".deactivate"))e(this).off("click");else{e(this).on("mousemove touchmove",function(t){var n=e(this).closest(".toggle-button"),r=(t.pageX||t.originalEvent.targetTouches[0].pageX)-n.offset().left,i=r/(l.width*2)*100;p=!0;t.stopImmediatePropagation();t.preventDefault();i<25?i=25:i>75&&(i=75);n.find(">div").css("left",i-75+"%")});e(this).on("click touchend",function(t){var n=e(t.target),r=n.siblings("input");t.stopImmediatePropagation();t.preventDefault();e(this).off("mouseleave");p?parseInt(e(this).parent().css("left"))<-25?r.attr("checked",!1):r.attr("checked",!0):r.attr("checked",!r.is(":checked"));r.trigger("change")});e(this).on("mouseleave",function(t){var n=e(this).siblings("input");t.preventDefault();t.stopImmediatePropagation();e(this).off("mouseleave");e(this).trigger("mouseup");parseInt(e(this).parent().css("left"))<-25?n.attr("checked",!1):n.attr("checked",!0);n.trigger("change")});e(this).on("mouseup",function(t){t.stopImmediatePropagation();t.preventDefault();e(this).off("mousemove")})}})});return this},toggleActivation:function(){e(this).toggleClass("deactivate")},toggleState:function(t){var n=e(this).find("input");n.attr("checked",!n.is(":checked")).trigger("change",t)},setState:function(t,n){e(this).find("input").attr("checked",t).trigger("change",n)},status:function(){return e(this).find("input:checkbox").is(":checked")},destroy:function(){var t=e(this).find("div"),n;t.find(":not(input:checkbox)").remove();n=t.children();n.unwrap().unwrap();n.unbind("change");return n}};if(o[n])return o[n].apply(this,Array.prototype.slice.call(arguments,1));if(typeof n=="object"||!n)return o.init.apply(this,arguments);e.error("Method "+n+" does not exist!")};e.fn.toggleButtons.defaults={onChange:function(){},width:100,height:25,font:{},animated:!0,transitionspeed:undefined,label:{enabled:undefined,disabled:undefined},style:{enabled:undefined,disabled:undefined,custom:{enabled:{background:undefined,gradient:undefined,color:"#FFFFFF"},disabled:{background:undefined,gradient:undefined,color:"#FFFFFF"}}}}}($);